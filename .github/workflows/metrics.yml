name: Project Health Metrics
on:
  push:
    branches: [ main, master ]
  workflow_dispatch: 

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0 

      - name: Calculate Metrics
        run: |
          # Usa rev-list --count para retornar somente o numero
          FEAT=$(git rev-list --count --since="1 month ago" --grep="^feature:" HEAD)
          BUG=$(git rev-list --count --since="1 month ago" --grep="^bug:" HEAD)
          EPIC=$(git rev-list --count --since="1 month ago" --grep="^epic:" HEAD)
          DOCS=$(git rev-list --count --since="1 month ago" --grep="^docs:" HEAD)
          CHORE=$(git rev-list --count --since="1 month ago" --grep="^chore:" HEAD)

          echo "### ðŸ“Š Resumo de Entregas (Ãšltimos 30 dias)" >> $GITHUB_STEP_SUMMARY
          echo ":sparkles: - **$FEAT** Novas features criadas" >> $GITHUB_STEP_SUMMARY
          echo ":bug: - **$BUG** Bugs resolvidos" >> $GITHUB_STEP_SUMMARY
          echo ":rocket: - **$EPIC** Ã‰picos trabalhados" >> $GITHUB_STEP_SUMMARY
          echo ":books: - **$DOCS** DocumentaÃ§Ãµes atualizadas" >> $GITHUB_STEP_SUMMARY
          echo ":wrench: - **$CHORE** Tarefas de manutenÃ§Ã£o (Chores)" >> $GITHUB_STEP_SUMMARY
          
          echo "---" >> $GITHUB_STEP_SUMMARY
          echo "_RelatÃ³rio gerado automaticamente baseado no padrÃ£o de commits do time._" >> $GITHUB_STEP_SUMMARY